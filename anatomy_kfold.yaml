debug: False
overwrite: True
ndim: 3
run_id: anatomy_kfold_run # Nome base para as pastas de resultado
out_dir: output
model_dir: models
log_dir: logs
seed: 42
device: 'cuda'

# --- Configurações de Dados ---
data:
  data_dir: prostate158
  train_csv: prostate158/train.csv
  valid_csv: prostate158/valid.csv
  test_csv: prostate158/test.csv
  image_cols: "t2"
  label_cols: "t2_anatomy_reader1"
  dataset_type: persistent
  cache_dir: cache/monai_cache # Caminho relativo, seguro para Windows
  batch_size: 4

# --- Configurações de Transformações (Corrigidas) ---
transforms:
  prob: 0.15 
  mode: ["bilinear", "nearest"]
  # Probabilidades são definidas por transformação para maior controle.
  spacing: [0.5, 0.5, 0.5]
  orientation: RAS

  # Aumentos de dados espaciais
  rand_affine:
    rotate_range: 5
    shear_range: 0.5
    translate_range: 25
  rand_rotate90:
    spatial_axes: [0,1]
  rand_zoom:
    min: 0.9
    max: 1.1

  # Aumentos de dados de intensidade (simulando artefatos de MRI)
  rand_bias_field:
    degree: 3 # Grau menor é mais sutil
    coeff_range: [0.0, 0.1]
  rand_gaussian_smooth:
    sigma_x: [0.25, 1.5]
    sigma_y: [0.25, 1.5]
    sigma_z: [0.25, 1.5]
  rand_gibbs_nose:
    alpha: [0.5, 1.0]
  rand_gaussian_nose:
    mean: 0.0
    std: 0.1
  shift_intensity:
    offsets: 0.2
  adjust_contrast:
    gamma: 1.2

  # Cropping de patches
  rand_crop_pos_neg_label:
   spatial_size: [96, 96, 96]
   pos: 2
   neg: 1
   num_samples: 8 # Aumentado para mais variedade por passo

# --- Configurações do Modelo ---
model:
  name: UNet
  out_channels: 3
  channels: [16, 32, 64, 128, 256, 512]
  strides: [2, 2, 2, 2, 2]
  num_res_units: 4
  act: PRELU
  norm: BATCH
  dropout: 0.15

# --- Otimizador e Agendador ---
optimizer:
  AdamW:
    lr: 0.001
    weight_decay: 0.01
lr_scheduler:
  OneCycleLR:
    max_lr: 0.001

# --- Função de Perda ---
loss:
  DiceCELoss:
    include_background: False
    softmax: True
    to_onehot_y: True

# --- Configurações de Treinamento ---
training:
  max_epochs: 500
  early_stopping_patience: 50